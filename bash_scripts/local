#! /bin/sh

# --- local ---
# packs all archives for local testing and finally invokes mozilla

# paths
PROJECT=~/workspace/eniac
TEST=$PROJECT/test

# create jarfile for data
cd $PROJECT
jar cf $TEST/data.jar $(find data)

# create jarfile for skins
jar cf $TEST/skin.jar $(find skin)

# create jarfile for menu
jar cf $TEST/menu.jar $(find menu)

# create jarfile for language
jar cf $TEST/lang.jar $(find lang)

# create jarfiles for skin-plugins
jar cf $TEST/default_skin.jar $(find default -name '*.*')
# jar cf $TEST/robots_skin.jar $(find robots)

# create jarfile for classes
jar cmf $TEST/MANIFEST.MF $TEST/classes.jar $(find eniac -name '*.class')

# create indexlist
cd $TEST
jar i ./classes.jar

# sign jarfile
jarsigner -keystore keystore.com -storepass password -keypass password -signedjar tmp.jar classes.jar alias

# note: The keystore was generated by the following command:
# keytool -genkey -alias alias -keypass password -keystore keystore.com -storepass password

# remove unsigned jarfile and rename signed one
rm classes.jar
mv tmp.jar classes.jar

# kill running mozilla process if any
killall -9 mozilla-bin

# open mozilla for testing
mozilla $TEST/eniac.html &

exit 0
